<!DOCTYPE html>
<html>
<head>
    <title>CSRF Protection Test</title>
</head>
<body>
    <h2>üõ°Ô∏è CSRF Protection Test</h2>
    <button onclick="testWithoutToken()">Test WITHOUT CSRF Token (should fail)</button>
    <button onclick="testWithToken()">Test WITH CSRF Token (should work)</button>
    <div id="results"></div>

    <script>
        const API_BASE = 'http://localhost:3001';
        
        async function testWithoutToken() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>Testing without CSRF token...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/api/ai/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        data: [{test: 'data'}],
                        question: 'test question'
                    })
                });
                
                const result = await response.json();
                results.innerHTML += `<p>‚ùå Response: ${response.status} - ${JSON.stringify(result)}</p>`;
            } catch (error) {
                results.innerHTML += `<p>‚ùå Error: ${error.message}</p>`;
            }
        }
        
        async function testWithToken() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>Testing with CSRF token...</p>';
            
            try {
                // First get CSRF token
                const tokenResponse = await fetch(`${API_BASE}/api/csrf-token`, {
                    method: 'GET',
                    credentials: 'include',
                });
                
                const tokenData = await tokenResponse.json();
                const csrfToken = tokenData.csrfToken;
                
                results.innerHTML += `<p>‚úÖ Got CSRF token: ${csrfToken}</p>`;
                
                // Now make request with token
                const response = await fetch(`${API_BASE}/api/ai/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-Token': csrfToken
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        data: [{test: 'data'}],
                        question: 'test question'
                    })
                });
                
                const result = await response.json();
                results.innerHTML += `<p>‚úÖ Response: ${response.status} - ${JSON.stringify(result)}</p>`;
            } catch (error) {
                results.innerHTML += `<p>‚ùå Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>